<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<title>Polars Selectors | Bas Machielsen</title>


<meta property="twitter:site" content="@basss92">
<meta property="twitter:creator" content="@basss92">







  
    
  
<meta name="description" content="A small blogpost about selection of variables in polars.">


<meta property="og:site_name" content="Bas Machielsen">
<meta property="og:title" content="Polars Selectors | Bas Machielsen">
<meta property="og:description" content="A small blogpost about selection of variables in polars." />
<meta property="og:type" content="page" />
<meta property="og:url" content="/blog/2025-07-08-polars-selectors/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="/blog/sidebar-listing.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="/blog/sidebar-listing.png" >
    
    
  <meta itemprop="name" content="Polars Selectors">
<meta itemprop="description" content="Excellent. Let&rsquo;s dive into these more advanced and idiomatic Polars techniques. These patterns are crucial for writing concise, expressive, and efficient Polars code, moving beyond basic transformations into more nuanced data manipulation.
We will use a new example dataset for these concepts to better illustrate their specific use cases. Let&rsquo;s imagine a dataset from a university&rsquo;s course enrollment system.
import polars as pl import polars.selectors as cs # We&#39;ll need this for advanced column selection # Create our example DataFrame df_courses = pl."><meta itemprop="datePublished" content="2025-07-08T00:00:00+00:00" />
<meta itemprop="dateModified" content="2025-07-08T00:00:00+00:00" />
<meta itemprop="wordCount" content="1513">
<meta itemprop="keywords" content="" />
  
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="favicon_new.ico" type="image/x-icon">
  <link rel="icon" href="favicon_new.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.555ba9f33efffeb97887b561cc674ae6e47dfbe93583e9f789fc69722e60a59e.css" integrity="sha256-VVup8z7//rl4h7VhzGdK5uR9&#43;&#43;k1g&#43;n3ifxpci5gpZ4=" media="screen">
  
  
  <script src="/panelset.min.dca42702d7daf6fd31dc352efd2bcf0e4ac8c05ccaa58d9293f6177462de5d5f.js" type="text/javascript"></script>
  
  
  <script src="/main.min.11d2df4163a7df9fb9d31f699461f02d84700b160cd42fa951b0982fc4d468bc.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="/" title="Home">
      <img src="/website_logo.png" class="dib db-l h2 w-auto" alt="Bas Machielsen">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/" title="Home">Home</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Teaching Overview &amp; Repository">Teaching</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/resume/" title="Resume">Resume</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/articles/" title="Articles">Articles</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/collection/" title="Software">Software</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Polars Selectors</h1>
        
        <p class="f6 measure lh-copy mv1">By Bas Machielsen</p>
        <p class="f7 db mv0 ttu">July 8, 2025</p>

      

      </header>
      <section class="post-body pt5 pb4">
        <p>Excellent. Let&rsquo;s dive into these more advanced and idiomatic Polars techniques. These patterns are crucial for writing concise, expressive, and efficient Polars code, moving beyond basic transformations into more nuanced data manipulation.</p>
<p>We will use a new example dataset for these concepts to better illustrate their specific use cases. Let&rsquo;s imagine a dataset from a university&rsquo;s course enrollment system.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">polars</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">pl</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">polars.selectors</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">cs</span> <span style="color:#998;font-style:italic"># We&#39;ll need this for advanced column selection</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Create our example DataFrame</span>
</span></span><span style="display:flex;"><span>df_courses <span style="color:#000;font-weight:bold">=</span> pl<span style="color:#000;font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;student_id&#34;</span>: [<span style="color:#099">101</span>, <span style="color:#099">102</span>, <span style="color:#099">101</span>, <span style="color:#099">103</span>, <span style="color:#099">102</span>, <span style="color:#099">104</span>, <span style="color:#099">101</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;full_name&#34;</span>: [<span style="color:#d14">&#34;Alice Smith&#34;</span>, <span style="color:#d14">&#34;Bob Johnson&#34;</span>, <span style="color:#d14">&#34;Alice Smith&#34;</span>, <span style="color:#d14">&#34;Charlie Brown&#34;</span>, <span style="color:#d14">&#34;Bob Johnson&#34;</span>, <span style="color:#d14">&#34;Diana Prince&#34;</span>, <span style="color:#d14">&#34;Alice Smith&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;course_name&#34;</span>: [<span style="color:#d14">&#34;Intro to CS&#34;</span>, <span style="color:#d14">&#34;Linear Algebra&#34;</span>, <span style="color:#d14">&#34;Data Structures&#34;</span>, <span style="color:#d14">&#34;Calc I&#34;</span>, <span style="color:#d14">&#34;Linear Algebra&#34;</span>, <span style="color:#d14">&#34;World History&#34;</span>, <span style="color:#d14">&#34;Algorithms&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;grade_numeric&#34;</span>: [<span style="color:#099">95.5</span>, <span style="color:#099">88.0</span>, <span style="color:#099">91.2</span>, <span style="color:#099">76.0</span>, <span style="color:#099">89.5</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#099">98.1</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;grade_letter&#34;</span>: [<span style="color:#d14">&#34;A&#34;</span>, <span style="color:#d14">&#34;B&#34;</span>, <span style="color:#d14">&#34;A&#34;</span>, <span style="color:#d14">&#34;C&#34;</span>, <span style="color:#d14">&#34;B&#34;</span>, <span style="color:#d14">&#34;A&#34;</span>, <span style="color:#d14">&#34;A&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;credits&#34;</span>: [<span style="color:#099">4</span>, <span style="color:#099">4</span>, <span style="color:#099">4</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>]
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><hr>




<h3 id="advanced-indexing-selecting-data-by-position">Advanced Indexing: Selecting Data by Position
  <a href="#advanced-indexing-selecting-data-by-position"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>While filtering data based on its content (<code>.filter()</code>) is the most common way to select rows, there are times when you need to select data based on its integer position or index. Polars provides powerful and efficient ways to do this, far beyond simple head/tail operations.</p>




<h4 id="method-1-chaining-nth-drop-and-slice">Method 1: Chaining <code>nth</code>, <code>drop</code>, and <code>slice</code>
  <a href="#method-1-chaining-nth-drop-and-slice"></a>
</h4>
<p>This method shows the power of chaining operations together to achieve a precise subset. Let&rsquo;s break down the user&rsquo;s first snippet: <code>(df.select(...).drop(...)).slice(...)</code>.</p>
<ol>
<li>
<p><strong><code>pl.nth(indices)</code></strong>: This expression is used within a <code>select</code> or <code>filter</code> context to pick rows by their specific, zero-based index. You can provide a single index or a list of indices. It&rsquo;s the equivalent of &ldquo;give me the 0th row, the 1st row, and the rows from index 3 to 5.&rdquo;</p>
</li>
<li>
<p><strong><code>.drop(column_name)</code></strong>: This is a straightforward method to remove one or more columns from the DataFrame after they have been used in a calculation or selection.</p>
</li>
<li>
<p><strong><code>.slice(offset, length)</code></strong>: This method selects a contiguous block (a &ldquo;slice&rdquo;) of rows from a DataFrame, starting at the <code>offset</code> index and taking <code>length</code> rows.</p>
</li>
</ol>
<p>Let&rsquo;s apply this logic to our <code>df_courses</code> dataset. Imagine we want to select the first two rows and rows 4 through 5, create a lowercase version of the <code>course_name</code>, drop the original <code>course_name</code>, and then from that result, take only the rows starting from the 4th position.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The logic from the user&#39;s snippet, applied to our data</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Let&#39;s rename &#39;Cursus&#39; to &#39;course_name&#39; for our example</span>
</span></span><span style="display:flex;"><span>complex_selection <span style="color:#000;font-weight:bold">=</span> (
</span></span><span style="display:flex;"><span>    df_courses
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>        pl<span style="color:#000;font-weight:bold">.</span>nth([<span style="color:#099">0</span>, <span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">range</span>(<span style="color:#099">3</span>, <span style="color:#099">5</span>))), <span style="color:#998;font-style:italic"># Select rows 0, 1, 3, 4</span>
</span></span><span style="display:flex;"><span>        test<span style="color:#000;font-weight:bold">=</span>pl<span style="color:#000;font-weight:bold">.</span>col(<span style="color:#d14">&#34;course_name&#34;</span>)<span style="color:#000;font-weight:bold">.</span>str<span style="color:#000;font-weight:bold">.</span>to_lowercase() <span style="color:#998;font-style:italic"># Create a new column &#39;test&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">.</span>drop(<span style="color:#d14">&#34;course_name&#34;</span>) <span style="color:#998;font-style:italic"># Drop the original column</span>
</span></span><span style="display:flex;"><span>)<span style="color:#000;font-weight:bold">.</span>slice(<span style="color:#099">2</span>, <span style="color:#099">2</span>) <span style="color:#998;font-style:italic"># From the result, take 2 rows starting at index 2</span>
</span></span></code></pre></div><p>This chain is executed sequentially. First Polars selects rows <code>[0, 1, 3, 4]</code>, creating a new 4-row DataFrame. Then, <code>.slice(2, 2)</code> is applied to this <em>new</em> DataFrame, selecting the final two rows (which were originally rows 3 and 4 of <code>df_courses</code>).</p>




<h4 id="method-2-using-polarsselectors">Method 2: Using <code>polars.selectors</code>
  <a href="#method-2-using-polarsselectors"></a>
</h4>
<p>Polars has a dedicated module, <code>polars.selectors</code> (conventionally imported as <code>cs</code>), for creating expressive column selections. This is often cleaner than manual list building.</p>
<p>The user&rsquo;s snippet <code>cs.by_index(...)</code> is a powerful column selector. It allows you to select columns based on their integer position.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Select the first two columns (student_id, full_name) and the last three columns</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># using their indices.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Note: list(range(3,6)) corresponds to columns at index 3, 4, and 5.</span>
</span></span><span style="display:flex;"><span>selected_cols_by_index <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    cs<span style="color:#000;font-weight:bold">.</span>by_index([<span style="color:#099">0</span>, <span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">+</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">range</span>(<span style="color:#099">3</span>, <span style="color:#099">6</span>)))
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Using selectors like <code>cs.by_index()</code>, <code>cs.by_name()</code>, <code>cs.by_dtype()</code>, or <code>cs.matches()</code> is the modern, idiomatic way to build lists of columns for operations within <code>select</code> or <code>with_columns</code>.</p>




<h3 id="dynamic-column-transformations-and-renaming">Dynamic Column Transformations and Renaming
  <a href="#dynamic-column-transformations-and-renaming"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>As your data pipelines grow, you often need to apply transformations not just to column values, but to the column names themselves.</p>




<h4 id="dynamic-renaming-with-a-lambda-function">Dynamic Renaming with a Lambda Function
  <a href="#dynamic-renaming-with-a-lambda-function"></a>
</h4>
<p>The <code>.rename()</code> method can accept a dictionary for explicit renames, but its real power lies in accepting a function (like a lambda). This function is applied to every column name, allowing you to perform programmatic renames across the entire DataFrame.</p>
<p>Let&rsquo;s say we want to standardize our column names to be all lowercase and have no underscores.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The user&#39;s snippet applied to our df_courses</span>
</span></span><span style="display:flex;"><span>df_renamed <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>rename(
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">lambda</span> column_name: column_name<span style="color:#000;font-weight:bold">.</span>lower()<span style="color:#000;font-weight:bold">.</span>replace(<span style="color:#d14">&#34;_&#34;</span>, <span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># This will transform &#39;student_id&#39; -&gt; &#39;studentid&#39;, &#39;full_name&#39; -&gt; &#39;fullname&#39;, etc.</span>
</span></span></code></pre></div><p>This is incredibly useful for cleaning up data from sources with inconsistent naming conventions.</p>




<h4 id="the-universal-selector-plall">The Universal Selector: <code>pl.all()</code>
  <a href="#the-universal-selector-plall"></a>
</h4>
<p>Often you want to apply an operation to <em>every</em> column. <code>pl.all()</code> is a selector that means exactly that: &ldquo;all columns&rdquo;. It&rsquo;s a powerful shorthand that prevents you from having to type out every column name.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Append a suffix to all column names</span>
</span></span><span style="display:flex;"><span>df_suffixed <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    pl<span style="color:#000;font-weight:bold">.</span>all()<span style="color:#000;font-weight:bold">.</span>suffix(<span style="color:#d14">&#34;_original&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># You can also exclude columns from the &#39;all&#39; selection</span>
</span></span><span style="display:flex;"><span>df_all_but_id <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    pl<span style="color:#000;font-weight:bold">.</span>all()<span style="color:#000;font-weight:bold">.</span>exclude(<span style="color:#d14">&#34;student_id&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Check if any value in any column is null</span>
</span></span><span style="display:flex;"><span>null_check <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    pl<span style="color:#000;font-weight:bold">.</span>all()<span style="color:#000;font-weight:bold">.</span>is_null()<span style="color:#000;font-weight:bold">.</span>any()
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><code>pl.all()</code> is your go-to tool for DataFrame-wide transformations. It pairs beautifully with other selectors like <code>.exclude()</code> and methods like <code>.prefix()</code> or <code>.suffix()</code> to create expressive and maintainable code.</p>




<h3 id="combining-dataframes-the-concat-operation">Combining DataFrames: The <code>concat</code> Operation
  <a href="#combining-dataframes-the-concat-operation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Stitching DataFrames together is a fundamental task. Polars&rsquo; <code>pl.concat()</code> function is a versatile tool for this, and the <code>how</code> parameter dictates its behavior.</p>
<p>Let&rsquo;s create two simple DataFrames to demonstrate.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>df1 <span style="color:#000;font-weight:bold">=</span> pl<span style="color:#000;font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;a&#34;</span>: [<span style="color:#099">1</span>, <span style="color:#099">2</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;b&#34;</span>: [<span style="color:#099">3</span>, <span style="color:#099">4</span>]
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df2 <span style="color:#000;font-weight:bold">=</span> pl<span style="color:#000;font-weight:bold">.</span>DataFrame({
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;a&#34;</span>: [<span style="color:#099">5</span>, <span style="color:#099">6</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#d14">&#34;c&#34;</span>: [<span style="color:#099">7</span>, <span style="color:#099">8</span>]
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><ul>
<li>
<p><strong><code>how=&quot;vertical&quot;</code> (default)</strong>: This stacks DataFrames on top of each other. It will match columns by name and fill missing values with nulls. This is the most common type of concatenation.</p>
</li>
<li>
<p><strong><code>how=&quot;horizontal&quot;</code></strong>: This places DataFrames side-by-side, creating a wider DataFrame. This is only advisable if the DataFrames have the same height and no overlapping column names.</p>
</li>
<li>
<p><strong><code>how=&quot;diagonal&quot;</code></strong>: This is a more specialized method shown in the user&rsquo;s snippet. It concatenates the DataFrames along the diagonal, extending both rows and columns. It effectively places the second DataFrame below and to the right of the first one, filling the misaligned quadrants with nulls.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The user&#39;s snippet shows diagonal concatenation</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># We will use df1 and df2 which have a similar structure to the user&#39;s df3 and df4</span>
</span></span><span style="display:flex;"><span>concatenated_diagonal <span style="color:#000;font-weight:bold">=</span> pl<span style="color:#000;font-weight:bold">.</span>concat([df1, df2], how<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;diagonal&#34;</span>)
</span></span></code></pre></div><p>The resulting <code>concatenated_diagonal</code> DataFrame will have columns <code>a</code>, <code>b</code>, and <code>c</code>. The first two rows will have values for <code>a</code> and <code>b</code> (from <code>df1</code>) and null for <code>c</code>. The next two rows will have values for <code>a</code> and <code>c</code> (from <code>df2</code>) and null for <code>b</code>. This is useful in scenarios where you are merging data from different schemas that have some overlap but are fundamentally staggered.</p>




<h3 id="custom-functions-a-guide-to-performance-and-pitfalls">Custom Functions: A Guide to Performance and Pitfalls
  <a href="#custom-functions-a-guide-to-performance-and-pitfalls"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>What happens when a built-in Polars expression doesn&rsquo;t exist for your specific, complex logic? Polars provides ways to apply custom Python functions, but it&rsquo;s crucial to understand the performance hierarchy.</p>
<p><strong>The Golden Rule: Native expressions are always fastest. Use custom Python functions only when absolutely necessary.</strong></p>
<p>Let&rsquo;s establish a clear hierarchy from most-performant to least-performant.</p>




<h4 id="1-slowest-row-wise-plapply">1. (Slowest) Row-wise <code>pl.apply</code>
  <a href="#1-slowest-row-wise-plapply"></a>
</h4>
<p>This applies a Python function to each row. As discussed previously, this is an <strong>anti-pattern</strong> and should be avoided. It serializes the process and involves costly data conversion between Rust and Python for every single row.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The user&#39;s snippet: calculating sum of two columns row by row</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># THIS IS VERY SLOW AND NOT RECOMMENDED</span>
</span></span><span style="display:flex;"><span>df_slow_apply <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    pl<span style="color:#000;font-weight:bold">.</span>apply([<span style="color:#d14">&#34;grade_numeric&#34;</span>, <span style="color:#d14">&#34;credits&#34;</span>], <span style="color:#000;font-weight:bold">lambda</span> row_values: row_values[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+</span> row_values[<span style="color:#099">1</span>])
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The correct, native, and blazingly fast way to do this:</span>
</span></span><span style="display:flex;"><span>df_fast_native <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    (pl<span style="color:#000;font-weight:bold">.</span>col(<span style="color:#d14">&#34;grade_numeric&#34;</span>) <span style="color:#000;font-weight:bold">+</span> pl<span style="color:#000;font-weight:bold">.</span>col(<span style="color:#d14">&#34;credits&#34;</span>))
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div>



<h4 id="2-better-element-wise-map">2. (Better) Element-wise <code>.map()</code>
  <a href="#2-better-element-wise-map"></a>
</h4>
<p>The <code>.map()</code> (or its alias <code>.apply</code> on an expression) method applies a Python function to each <em>element</em> within a column. This is still slower than a native expression because of the Python function call overhead for each value, but it is significantly better than a row-wise apply.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The user&#39;s snippet: multiply every value in every column by 2</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># This will fail on non-numeric columns, so let&#39;s select numeric ones first</span>
</span></span><span style="display:flex;"><span>df_mapped <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>select(
</span></span><span style="display:flex;"><span>    cs<span style="color:#000;font-weight:bold">.</span>numeric()<span style="color:#000;font-weight:bold">.</span>map(<span style="color:#000;font-weight:bold">lambda</span> value: value <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">if</span> value <span style="color:#000;font-weight:bold">is</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#000;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>This is best used for complex transformations on single values for which no native Polars function exists.</p>




<h4 id="3-fastest-custom-method-structmap">3. (Fastest Custom Method) <code>.struct().map()</code>
  <a href="#3-fastest-custom-method-structmap"></a>
</h4>
<p>This is the idiomatic Polars solution for performing custom row-wise logic that involves multiple columns. It strikes a balance between flexibility and performance.</p>
<ol>
<li><strong><code>pl.struct([...])</code></strong>: You first bundle the columns you need for your calculation into a temporary <code>Struct</code>.</li>
<li><strong><code>.map(lambda s: ...)</code></strong>: You then apply your Python function to this <code>Struct</code> object.</li>
</ol>
<p>The magic here is that Polars can pass the entire <code>Struct</code> to Python much more efficiently than individual row elements. The lambda function receives a dictionary-like object, which is easy and readable to work with.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># The user&#39;s snippet: divide col1 by col2. Let&#39;s use our data.</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Goal: Calculate a custom &#39;weighted_grade&#39; = grade_numeric * (credits / 4)</span>
</span></span><span style="display:flex;"><span>df_struct_map <span style="color:#000;font-weight:bold">=</span> df_courses<span style="color:#000;font-weight:bold">.</span>with_columns(
</span></span><span style="display:flex;"><span>    pl<span style="color:#000;font-weight:bold">.</span>struct([<span style="color:#d14">&#34;grade_numeric&#34;</span>, <span style="color:#d14">&#34;credits&#34;</span>])
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">.</span>map(
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">lambda</span> s: s[<span style="color:#d14">&#34;grade_numeric&#34;</span>] <span style="color:#000;font-weight:bold">*</span> (s[<span style="color:#d14">&#34;credits&#34;</span>] <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">4</span>)
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">.</span>alias(<span style="color:#d14">&#34;weighted_grade&#34;</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>This approach is vastly superior to <code>.apply()</code> because it minimizes the overhead between Rust and Python and allows the query optimizer to better reason about the operation. When you absolutely need custom logic across columns, <code>struct().map()</code> is the tool to reach for.</p>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">July 8, 2025</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">8 minute read, 1513 words</dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="/blog/2025-07-08-python-polars-demonstration-for-data-wrangling/">Python Polars Demonstration for Data Wrangling &rarr;</a>
  
</div>

      </footer>
    </article>
    
      
<div class="post-comments pa0 pa4-l mt4">
  
  <script src="https://utteranc.es/client.js"
          repo="basm92/new_website"
          issue-term="pathname"
          theme="boxy-light"
          label="comments :crystal_ball:"
          crossorigin="anonymous"
          async
          type="text/javascript">
  </script>
  
</div>

    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2025 Bas Machielsen
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/basm92" title="github" target="_blank" rel="noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://scholar.google.com/citations?user=bS8uo44AAAAJ" title="google" target="_blank" rel="noopener">
      <i class="fab fa-google fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://twitter.com/basss92" title="twitter" target="_blank" rel="noopener">
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="mailto:a.h.machielsen@uu.nl" title="envelope" >
      <i class="fas fa-envelope fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="mailto:basmachielsen@live.nl" title="envelope" >
      <i class="far fa-envelope fa-lg fa-fw"></i>
    </a>
  
    
    
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://orcid.org/0000-0002-9692-0615" title="orcid" target="_blank" rel="noopener">
      <i class="ai ai-orcid fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="/blog/index.xml" title="rss" >
      <i class="fas fa-rss fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">License</a>
      
      <a class="dib pv1 ph2 link" href="/contact/" title="Contact form">Contact</a>
      
      <a class="dib pv1 ph2 link" href="/contributors/" title="Contributors">Contributors</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
